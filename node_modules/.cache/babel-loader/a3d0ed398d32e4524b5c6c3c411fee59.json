{"ast":null,"code":"var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n/*!\n  * Amazon Cognito Auth SDK for JavaScript\n  * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\").\n  * You may not use this file except in compliance with the License.\n  * A copy of the License is located at\n  *\n  *         http://aws.amazon.com/apache2.0/\n  *\n  * or in the \"license\" file accompanying this file.\n  * This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES\n  * OR CONDITIONS OF ANY KIND, either express or implied. See the\n  * License for the specific language governing permissions\n  * and limitations under the License.\n  */\n\n\nimport CognitoTokenScopes from './CognitoTokenScopes';\nimport CognitoAccessToken from './CognitoAccessToken';\nimport CognitoIdToken from './CognitoIdToken';\nimport CognitoRefreshToken from './CognitoRefreshToken';\nimport CognitoAuthSession from './CognitoAuthSession';\nimport StorageHelper from './StorageHelper';\nimport { launchUri } from './UriHelper';\n/** @class */\n\nvar CognitoAuth = function () {\n  /**\n   * Constructs a new CognitoAuth object\n   * @param {object} data Creation options\n   * @param {string} data.ClientId Required: User pool application client id.\n   * @param {string} data.AppWebDomain Required: The application/user-pools Cognito web hostname,\n   *                     this is set at the Cognito console.\n   * @param {array} data.TokenScopesArray Optional: The token scopes\n   * @param {string} data.RedirectUriSignIn Required: The redirect Uri,\n   * which will be launched after authentication as signed in.\n   * @param {string} data.RedirectUriSignOut Required:\n   * The redirect Uri, which will be launched when signed out.\n   * @param {string} data.IdentityProvider Optional: Pre-selected identity provider (this allows to\n   * automatically trigger social provider authentication flow).\n   * @param {string} data.UserPoolId Optional: UserPoolId for the configured cognito userPool.\n   * @param {boolean} data.AdvancedSecurityDataCollectionFlag Optional: boolean flag indicating if the\n   *        data collection is enabled to support cognito advanced security features. By default, this\n   *        flag is set to true.\n   * @param {object} data.Storage Optional: e.g. new CookieStorage(), to use the specified storage provided\n   * @param {function} data.LaunchUri Optional: Function to open a url, by default uses window.open in browser, Linking.openUrl in React Native\n   * @param {nodeCallback<CognitoAuthSession>} Optional: userhandler Called on success or error.\n   */\n  function CognitoAuth(data) {\n    _classCallCheck(this, CognitoAuth);\n\n    var _ref = data || {},\n        ClientId = _ref.ClientId,\n        AppWebDomain = _ref.AppWebDomain,\n        TokenScopesArray = _ref.TokenScopesArray,\n        RedirectUriSignIn = _ref.RedirectUriSignIn,\n        RedirectUriSignOut = _ref.RedirectUriSignOut,\n        IdentityProvider = _ref.IdentityProvider,\n        UserPoolId = _ref.UserPoolId,\n        AdvancedSecurityDataCollectionFlag = _ref.AdvancedSecurityDataCollectionFlag,\n        Storage = _ref.Storage,\n        LaunchUri = _ref.LaunchUri;\n\n    if (data == null || !ClientId || !AppWebDomain || !RedirectUriSignIn || !RedirectUriSignOut) {\n      throw new Error(this.getCognitoConstants().PARAMETERERROR);\n    }\n\n    this.clientId = ClientId;\n    this.appWebDomain = AppWebDomain;\n    this.TokenScopesArray = TokenScopesArray || [];\n\n    if (!Array.isArray(TokenScopesArray)) {\n      throw new Error(this.getCognitoConstants().SCOPETYPEERROR);\n    }\n\n    var tokenScopes = new CognitoTokenScopes(this.TokenScopesArray);\n    this.RedirectUriSignIn = RedirectUriSignIn;\n    this.RedirectUriSignOut = RedirectUriSignOut;\n    this.IdentityProvider = IdentityProvider;\n    this.responseType = this.getCognitoConstants().TOKEN;\n    this.storage = Storage || new StorageHelper().getStorage();\n    this.username = this.getLastUser();\n    this.userPoolId = UserPoolId;\n    this.signInUserSession = this.getCachedSession();\n    this.signInUserSession.setTokenScopes(tokenScopes);\n    this.launchUri = typeof LaunchUri === 'function' ? LaunchUri : launchUri;\n    /**\n     * By default, AdvancedSecurityDataCollectionFlag is set to true, if no input value is provided.\n     */\n\n    this.advancedSecurityDataCollectionFlag = true;\n\n    if (AdvancedSecurityDataCollectionFlag) {\n      this.advancedSecurityDataCollectionFlag = AdvancedSecurityDataCollectionFlag;\n    }\n  }\n  /**\n   * @returns {JSON} the constants\n   */\n\n\n  CognitoAuth.prototype.getCognitoConstants = function getCognitoConstants() {\n    var CognitoConstants = {\n      DOMAIN_SCHEME: 'https',\n      DOMAIN_PATH_SIGNIN: 'oauth2/authorize',\n      DOMAIN_PATH_TOKEN: 'oauth2/token',\n      DOMAIN_PATH_SIGNOUT: 'logout',\n      DOMAIN_QUERY_PARAM_REDIRECT_URI: 'redirect_uri',\n      DOMAIN_QUERY_PARAM_SIGNOUT_URI: 'logout_uri',\n      DOMAIN_QUERY_PARAM_RESPONSE_TYPE: 'response_type',\n      DOMAIN_QUERY_PARAM_IDENTITY_PROVIDER: 'identity_provider',\n      DOMAIN_QUERY_PARAM_USERCONTEXTDATA: 'userContextData',\n      CLIENT_ID: 'client_id',\n      STATE: 'state',\n      SCOPE: 'scope',\n      TOKEN: 'token',\n      CODE: 'code',\n      POST: 'POST',\n      PARAMETERERROR: 'The parameters: App client Id, App web domain' + ', the redirect URL when you are signed in and the ' + 'redirect URL when you are signed out are required.',\n      SCOPETYPEERROR: 'Scopes have to be array type. ',\n      QUESTIONMARK: '?',\n      POUNDSIGN: '#',\n      COLONDOUBLESLASH: '://',\n      SLASH: '/',\n      AMPERSAND: '&',\n      EQUALSIGN: '=',\n      SPACE: ' ',\n      CONTENTTYPE: 'Content-Type',\n      CONTENTTYPEVALUE: 'application/x-www-form-urlencoded',\n      AUTHORIZATIONCODE: 'authorization_code',\n      IDTOKEN: 'id_token',\n      ACCESSTOKEN: 'access_token',\n      REFRESHTOKEN: 'refresh_token',\n      ERROR: 'error',\n      ERROR_DESCRIPTION: 'error_description',\n      STRINGTYPE: 'string',\n      STATELENGTH: 32,\n      STATEORIGINSTRING: '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',\n      WITHCREDENTIALS: 'withCredentials',\n      UNDEFINED: 'undefined',\n      HOSTNAMEREGEX: /:\\/\\/([0-9]?\\.)?(.[^/:]+)/i,\n      QUERYPARAMETERREGEX1: /#(.+)/,\n      QUERYPARAMETERREGEX2: /=(.+)/,\n      HEADER: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }\n    };\n    return CognitoConstants;\n  };\n  /**\n   * @returns {string} the client id\n   */\n\n\n  CognitoAuth.prototype.getClientId = function getClientId() {\n    return this.clientId;\n  };\n  /**\n   * @returns {string} the app web domain\n   */\n\n\n  CognitoAuth.prototype.getAppWebDomain = function getAppWebDomain() {\n    return this.appWebDomain;\n  };\n  /**\n   * method for getting the current user of the application from the local storage\n   *\n   * @returns {CognitoAuth} the user retrieved from storage\n   */\n\n\n  CognitoAuth.prototype.getCurrentUser = function getCurrentUser() {\n    var lastUserKey = 'CognitoIdentityServiceProvider.' + this.clientId + '.LastAuthUser';\n    var lastAuthUser = this.storage.getItem(lastUserKey);\n    return lastAuthUser;\n  };\n  /**\n   * @param {string} Username the user's name\n   * method for setting the current user's name\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.setUser = function setUser(Username) {\n    this.username = Username;\n  };\n  /**\n   * sets response type to 'code'\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.useCodeGrantFlow = function useCodeGrantFlow() {\n    this.responseType = this.getCognitoConstants().CODE;\n  };\n  /**\n   * sets response type to 'token'\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.useImplicitFlow = function useImplicitFlow() {\n    this.responseType = this.getCognitoConstants().TOKEN;\n  };\n  /**\n   * @returns {CognitoAuthSession} the current session for this user\n   */\n\n\n  CognitoAuth.prototype.getSignInUserSession = function getSignInUserSession() {\n    return this.signInUserSession;\n  };\n  /**\n   * @returns {string} the user's username\n   */\n\n\n  CognitoAuth.prototype.getUsername = function getUsername() {\n    return this.username;\n  };\n  /**\n   * @param {string} Username the user's username\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.setUsername = function setUsername(Username) {\n    this.username = Username;\n  };\n  /**\n   * @returns {string} the user's state\n   */\n\n\n  CognitoAuth.prototype.getState = function getState() {\n    return this.state;\n  };\n  /**\n   * @param {string} State the user's state\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.setState = function setState(State) {\n    this.state = State;\n  };\n  /**\n   * This is used to get a session, either from the session object\n   * or from the local storage, or by using a refresh token\n   * @param {string} RedirectUriSignIn Required: The redirect Uri,\n   * which will be launched after authentication.\n   * @param {array} TokenScopesArray Required: The token scopes, it is an\n   * array of strings specifying all scopes for the tokens.\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.getSession = function getSession() {\n    var tokenScopesInputSet = new Set(this.TokenScopesArray);\n    var cachedScopesSet = new Set(this.signInUserSession.tokenScopes.getScopes());\n    var URL = this.getFQDNSignIn();\n\n    if (this.signInUserSession != null && this.signInUserSession.isValid()) {\n      return this.userhandler.onSuccess(this.signInUserSession);\n    }\n\n    this.signInUserSession = this.getCachedSession(); // compare scopes\n\n    if (!this.compareSets(tokenScopesInputSet, cachedScopesSet)) {\n      var tokenScopes = new CognitoTokenScopes(this.TokenScopesArray);\n      var idToken = new CognitoIdToken();\n      var accessToken = new CognitoAccessToken();\n      var refreshToken = new CognitoRefreshToken();\n      this.signInUserSession.setTokenScopes(tokenScopes);\n      this.signInUserSession.setIdToken(idToken);\n      this.signInUserSession.setAccessToken(accessToken);\n      this.signInUserSession.setRefreshToken(refreshToken);\n      this.launchUri(URL);\n    } else if (this.signInUserSession.isValid()) {\n      return this.userhandler.onSuccess(this.signInUserSession);\n    } else if (!this.signInUserSession.getRefreshToken() || !this.signInUserSession.getRefreshToken().getToken()) {\n      this.launchUri(URL);\n    } else {\n      this.refreshSession(this.signInUserSession.getRefreshToken().getToken());\n    }\n\n    return undefined;\n  };\n  /**\n   * @param {string} httpRequestResponse the http request response\n   * @returns {void}\n   * Parse the http request response and proceed according to different response types.\n   */\n\n\n  CognitoAuth.prototype.parseCognitoWebResponse = function parseCognitoWebResponse(httpRequestResponse) {\n    var map = void 0;\n\n    if (httpRequestResponse.indexOf(this.getCognitoConstants().QUESTIONMARK) > -1) {\n      // for code type\n      // this is to avoid a bug exists when sign in with Google or facebook\n      // Sometimes the code will contain a poundsign in the end which breaks the parsing\n      var response = httpRequestResponse.split(this.getCognitoConstants().POUNDSIGN)[0];\n      map = this.getQueryParameters(response, this.getCognitoConstants().QUESTIONMARK);\n\n      if (map.has(this.getCognitoConstants().ERROR)) {\n        return this.userhandler.onFailure(map.get(this.getCognitoConstants().ERROR_DESCRIPTION));\n      }\n\n      this.getCodeQueryParameter(map);\n    } else if (httpRequestResponse.indexOf(this.getCognitoConstants().POUNDSIGN) > -1) {\n      // for token type\n      map = this.getQueryParameters(httpRequestResponse, this.getCognitoConstants().QUERYPARAMETERREGEX1);\n\n      if (map.has(this.getCognitoConstants().ERROR)) {\n        return this.userhandler.onFailure(map.get(this.getCognitoConstants().ERROR_DESCRIPTION));\n      } // To use the map to get tokens\n\n\n      this.getTokenQueryParameter(map);\n    }\n  };\n  /**\n   * @param {map} Query parameter map \n   * @returns {void}\n   * Get the query parameter map and proceed according to code response type.\n   */\n\n\n  CognitoAuth.prototype.getCodeQueryParameter = function getCodeQueryParameter(map) {\n    var state = null;\n\n    if (map.has(this.getCognitoConstants().STATE)) {\n      this.signInUserSession.setState(map.get(this.getCognitoConstants().STATE));\n    } else {\n      this.signInUserSession.setState(state);\n    }\n\n    if (map.has(this.getCognitoConstants().CODE)) {\n      // if the response contains code\n      // To parse the response and get the code value.\n      var codeParameter = map.get(this.getCognitoConstants().CODE);\n      var url = this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH, this.getAppWebDomain(), this.getCognitoConstants().SLASH, this.getCognitoConstants().DOMAIN_PATH_TOKEN);\n      var header = this.getCognitoConstants().HEADER;\n      var body = {\n        grant_type: this.getCognitoConstants().AUTHORIZATIONCODE,\n        client_id: this.getClientId(),\n        redirect_uri: this.RedirectUriSignIn,\n        code: codeParameter\n      };\n      var boundOnSuccess = this.onSuccessExchangeForToken.bind(this);\n      var boundOnFailure = this.onFailure.bind(this);\n      this.makePOSTRequest(header, body, url, boundOnSuccess, boundOnFailure);\n    }\n  };\n  /**\n   * Get the query parameter map and proceed according to token response type.\n   * @param {map} Query parameter map \n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.getTokenQueryParameter = function getTokenQueryParameter(map) {\n    var idToken = new CognitoIdToken();\n    var accessToken = new CognitoAccessToken();\n    var refreshToken = new CognitoRefreshToken();\n    var state = null;\n\n    if (map.has(this.getCognitoConstants().IDTOKEN)) {\n      idToken.setJwtToken(map.get(this.getCognitoConstants().IDTOKEN));\n      this.signInUserSession.setIdToken(idToken);\n    } else {\n      this.signInUserSession.setIdToken(idToken);\n    }\n\n    if (map.has(this.getCognitoConstants().ACCESSTOKEN)) {\n      accessToken.setJwtToken(map.get(this.getCognitoConstants().ACCESSTOKEN));\n      this.signInUserSession.setAccessToken(accessToken);\n    } else {\n      this.signInUserSession.setAccessToken(accessToken);\n    }\n\n    if (map.has(this.getCognitoConstants().STATE)) {\n      this.signInUserSession.setState(map.get(this.getCognitoConstants().STATE));\n    } else {\n      this.signInUserSession.setState(state);\n    }\n\n    this.cacheTokensScopes();\n    this.userhandler.onSuccess(this.signInUserSession);\n  };\n  /**\n   * Get cached tokens and scopes and return a new session using all the cached data.\n   * @returns {CognitoAuthSession} the auth session\n   */\n\n\n  CognitoAuth.prototype.getCachedSession = function getCachedSession() {\n    if (!this.username) {\n      return new CognitoAuthSession();\n    }\n\n    var keyPrefix = 'CognitoIdentityServiceProvider.' + this.getClientId() + '.' + this.username;\n    var idTokenKey = keyPrefix + '.idToken';\n    var accessTokenKey = keyPrefix + '.accessToken';\n    var refreshTokenKey = keyPrefix + '.refreshToken';\n    var scopeKey = keyPrefix + '.tokenScopesString';\n    var scopesString = this.storage.getItem(scopeKey);\n    var scopesArray = [];\n\n    if (scopesString) {\n      scopesArray = scopesString.split(' ');\n    }\n\n    var tokenScopes = new CognitoTokenScopes(scopesArray);\n    var idToken = new CognitoIdToken(this.storage.getItem(idTokenKey));\n    var accessToken = new CognitoAccessToken(this.storage.getItem(accessTokenKey));\n    var refreshToken = new CognitoRefreshToken(this.storage.getItem(refreshTokenKey));\n    var sessionData = {\n      IdToken: idToken,\n      AccessToken: accessToken,\n      RefreshToken: refreshToken,\n      TokenScopes: tokenScopes\n    };\n    var cachedSession = new CognitoAuthSession(sessionData);\n    return cachedSession;\n  };\n  /**\n   * This is used to get last signed in user from local storage\n   * @returns {string} the last user name\n   */\n\n\n  CognitoAuth.prototype.getLastUser = function getLastUser() {\n    var keyPrefix = 'CognitoIdentityServiceProvider.' + this.getClientId();\n    var lastUserKey = keyPrefix + '.LastAuthUser';\n    var lastUserName = this.storage.getItem(lastUserKey);\n\n    if (lastUserName) {\n      return lastUserName;\n    }\n\n    return undefined;\n  };\n  /**\n   * This is used to save the session tokens and scopes to local storage\n   * Input parameter is a set of strings.\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.cacheTokensScopes = function cacheTokensScopes() {\n    var keyPrefix = 'CognitoIdentityServiceProvider.' + this.getClientId();\n    var tokenUserName = this.signInUserSession.getAccessToken().getUsername();\n    this.username = tokenUserName;\n    var idTokenKey = keyPrefix + '.' + tokenUserName + '.idToken';\n    var accessTokenKey = keyPrefix + '.' + tokenUserName + '.accessToken';\n    var refreshTokenKey = keyPrefix + '.' + tokenUserName + '.refreshToken';\n    var lastUserKey = keyPrefix + '.LastAuthUser';\n    var scopeKey = keyPrefix + '.' + tokenUserName + '.tokenScopesString';\n    var scopesArray = this.signInUserSession.getTokenScopes().getScopes();\n    var scopesString = scopesArray.join(' ');\n    this.storage.setItem(idTokenKey, this.signInUserSession.getIdToken().getJwtToken());\n    this.storage.setItem(accessTokenKey, this.signInUserSession.getAccessToken().getJwtToken());\n    this.storage.setItem(refreshTokenKey, this.signInUserSession.getRefreshToken().getToken());\n    this.storage.setItem(lastUserKey, tokenUserName);\n    this.storage.setItem(scopeKey, scopesString);\n  };\n  /**\n   * Compare two sets if they are identical.\n   * @param {set} set1 one set\n   * @param {set} set2 the other set\n   * @returns {boolean} boolean value is true if two sets are identical\n   */\n\n\n  CognitoAuth.prototype.compareSets = function compareSets(set1, set2) {\n    if (set1.size !== set2.size) {\n      return false;\n    }\n\n    for (var _iterator = set1, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var item = _ref2;\n\n      if (!set2.has(item)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n  /**\n   * @param {string} url the url string\n   * Get the hostname from url.\n   * @returns {string} hostname string\n   */\n\n\n  CognitoAuth.prototype.getHostName = function getHostName(url) {\n    var match = url.match(this.getCognitoConstants().HOSTNAMEREGEX);\n\n    if (match != null && match.length > 2 && _typeof(match[2]) === this.getCognitoConstants().STRINGTYPE && match[2].length > 0) {\n      return match[2];\n    }\n\n    return undefined;\n  };\n  /**\n   * Get http query parameters and return them as a map.\n   * @param {string} url the url string\n   * @param {string} splitMark query parameters split mark (prefix)\n   * @returns {map} map\n   */\n\n\n  CognitoAuth.prototype.getQueryParameters = function getQueryParameters(url, splitMark) {\n    var str = String(url).split(splitMark);\n    var url2 = str[1];\n    var str1 = String(url2).split(this.getCognitoConstants().AMPERSAND);\n    var num = str1.length;\n    var map = new Map();\n    var i = void 0;\n\n    for (i = 0; i < num; i++) {\n      str1[i] = String(str1[i]).split(this.getCognitoConstants().QUERYPARAMETERREGEX2);\n      map.set(str1[i][0], str1[i][1]);\n    }\n\n    return map;\n  };\n  /**\n   * helper function to generate a random string\n   * @param {int} length the length of string\n   * @param {string} chars a original string\n   * @returns {string} a random value.\n   */\n\n\n  CognitoAuth.prototype.generateRandomString = function generateRandomString(length, chars) {\n    var result = '';\n    var i = length;\n\n    for (; i > 0; --i) {\n      result += chars[Math.round(Math.random() * (chars.length - 1))];\n    }\n\n    return result;\n  };\n  /**\n   * This is used to clear the session tokens and scopes from local storage\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.clearCachedTokensScopes = function clearCachedTokensScopes() {\n    var keyPrefix = 'CognitoIdentityServiceProvider.' + this.getClientId();\n    var idTokenKey = keyPrefix + '.' + this.username + '.idToken';\n    var accessTokenKey = keyPrefix + '.' + this.username + '.accessToken';\n    var refreshTokenKey = keyPrefix + '.' + this.username + '.refreshToken';\n    var lastUserKey = keyPrefix + '.LastAuthUser';\n    var scopeKey = keyPrefix + '.' + this.username + '.tokenScopesString';\n    this.storage.removeItem(idTokenKey);\n    this.storage.removeItem(accessTokenKey);\n    this.storage.removeItem(refreshTokenKey);\n    this.storage.removeItem(lastUserKey);\n    this.storage.removeItem(scopeKey);\n  };\n  /**\n   * This is used to build a user session from tokens retrieved in the authentication result\n   * @param {object} refreshToken authResult Successful auth response from server.\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.refreshSession = function refreshSession(refreshToken) {\n    // https POST call for refreshing token\n    var url = this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH, this.getAppWebDomain(), this.getCognitoConstants().SLASH, this.getCognitoConstants().DOMAIN_PATH_TOKEN);\n    var header = this.getCognitoConstants().HEADER;\n    var body = {\n      grant_type: this.getCognitoConstants().REFRESHTOKEN,\n      client_id: this.getClientId(),\n      redirect_uri: this.RedirectUriSignIn,\n      refresh_token: refreshToken\n    };\n    var boundOnSuccess = this.onSuccessRefreshToken.bind(this);\n    var boundOnFailure = this.onFailure.bind(this);\n    this.makePOSTRequest(header, body, url, boundOnSuccess, boundOnFailure);\n  };\n  /**\n   * Make the http POST request.\n   * @param {JSON} header header JSON object\n   * @param {JSON} body body JSON object\n   * @param {string} url string\n   * @param {function} onSuccess callback\n   * @param {function} onFailure callback\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.makePOSTRequest = function makePOSTRequest(header, body, url, onSuccess, onFailure) {\n    // This is a sample server that supports CORS.\n    var xhr = this.createCORSRequest(this.getCognitoConstants().POST, url);\n    var bodyString = '';\n\n    if (!xhr) {\n      return;\n    } // set header\n\n\n    for (var key in header) {\n      xhr.setRequestHeader(key, header[key]);\n    }\n\n    for (var _key in body) {\n      bodyString = bodyString.concat(_key, this.getCognitoConstants().EQUALSIGN, body[_key], this.getCognitoConstants().AMPERSAND);\n    }\n\n    bodyString = bodyString.substring(0, bodyString.length - 1);\n    xhr.send(bodyString);\n\n    xhr.onreadystatechange = function addressState() {\n      if (xhr.readyState === 4) {\n        if (xhr.status === 200) {\n          onSuccess(xhr.responseText);\n        } else {\n          onFailure(xhr.responseText);\n        }\n      }\n    };\n  };\n  /**\n   * Create the XHR object\n   * @param {string} method which method to call\n   * @param {string} url the url string\n   * @returns {object} xhr\n   */\n\n\n  CognitoAuth.prototype.createCORSRequest = function createCORSRequest(method, url) {\n    var xhr = new XMLHttpRequest();\n\n    if (this.getCognitoConstants().WITHCREDENTIALS in xhr) {\n      // XHR for Chrome/Firefox/Opera/Safari.\n      xhr.open(method, url, true);\n    } else if ((typeof XDomainRequest === 'undefined' ? 'undefined' : _typeof(XDomainRequest)) !== this.getCognitoConstants().UNDEFINED) {\n      // XDomainRequest for IE.\n      xhr = new XDomainRequest();\n      xhr.open(method, url);\n    } else {\n      // CORS not supported.\n      xhr = null;\n    }\n\n    return xhr;\n  };\n  /**\n   * The http POST request onFailure callback.\n   * @param {object} err the error object\n   * @returns {function} onFailure\n   */\n\n\n  CognitoAuth.prototype.onFailure = function onFailure(err) {\n    this.userhandler.onFailure(err);\n  };\n  /**\n   * The http POST request onSuccess callback when refreshing tokens.\n   * @param {JSON} jsonData tokens\n   */\n\n\n  CognitoAuth.prototype.onSuccessRefreshToken = function onSuccessRefreshToken(jsonData) {\n    var jsonDataObject = JSON.parse(jsonData);\n\n    if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().ERROR)) {\n      var URL = this.getFQDNSignIn();\n      this.launchUri(URL);\n    } else {\n      if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().IDTOKEN)) {\n        this.signInUserSession.setIdToken(new CognitoIdToken(jsonDataObject.id_token));\n      }\n\n      if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().ACCESSTOKEN)) {\n        this.signInUserSession.setAccessToken(new CognitoAccessToken(jsonDataObject.access_token));\n      }\n\n      this.cacheTokensScopes();\n      this.userhandler.onSuccess(this.signInUserSession);\n    }\n  };\n  /**\n   * The http POST request onSuccess callback when exchanging code for tokens.\n   * @param {JSON} jsonData tokens\n   */\n\n\n  CognitoAuth.prototype.onSuccessExchangeForToken = function onSuccessExchangeForToken(jsonData) {\n    var jsonDataObject = JSON.parse(jsonData);\n    var refreshToken = new CognitoRefreshToken();\n    var accessToken = new CognitoAccessToken();\n    var idToken = new CognitoIdToken();\n    var state = null;\n\n    if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().ERROR)) {\n      return this.userhandler.onFailure(jsonData);\n    }\n\n    if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().IDTOKEN)) {\n      this.signInUserSession.setIdToken(new CognitoIdToken(jsonDataObject.id_token));\n    } else {\n      this.signInUserSession.setIdToken(idToken);\n    }\n\n    if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().ACCESSTOKEN)) {\n      this.signInUserSession.setAccessToken(new CognitoAccessToken(jsonDataObject.access_token));\n    } else {\n      this.signInUserSession.setAccessToken(accessToken);\n    }\n\n    if (Object.prototype.hasOwnProperty.call(jsonDataObject, this.getCognitoConstants().REFRESHTOKEN)) {\n      this.signInUserSession.setRefreshToken(new CognitoRefreshToken(jsonDataObject.refresh_token));\n    } else {\n      this.signInUserSession.setRefreshToken(refreshToken);\n    }\n\n    this.cacheTokensScopes();\n    this.userhandler.onSuccess(this.signInUserSession);\n  };\n  /**\n   * Launch Cognito Auth UI page.\n   * @param {string} URL the url to launch\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.launchUri = function launchUri() {}; // overwritten in constructor\n\n  /**\n   * @returns {string} scopes string\n   */\n\n\n  CognitoAuth.prototype.getSpaceSeperatedScopeString = function getSpaceSeperatedScopeString() {\n    var tokenScopesString = this.signInUserSession.getTokenScopes().getScopes();\n    tokenScopesString = tokenScopesString.join(this.getCognitoConstants().SPACE);\n    return encodeURIComponent(tokenScopesString);\n  };\n  /**\n   * Create the FQDN(fully qualified domain name) for authorization endpoint.\n   * @returns {string} url\n   */\n\n\n  CognitoAuth.prototype.getFQDNSignIn = function getFQDNSignIn() {\n    if (this.state == null) {\n      this.state = this.generateRandomString(this.getCognitoConstants().STATELENGTH, this.getCognitoConstants().STATEORIGINSTRING);\n    }\n\n    var identityProviderParam = this.IdentityProvider ? this.getCognitoConstants().AMPERSAND.concat(this.getCognitoConstants().DOMAIN_QUERY_PARAM_IDENTITY_PROVIDER, this.getCognitoConstants().EQUALSIGN, this.IdentityProvider) : '';\n    var tokenScopesString = this.getSpaceSeperatedScopeString();\n    var userContextDataParam = '';\n    var userContextData = this.getUserContextData();\n\n    if (userContextData) {\n      userContextDataParam = this.getCognitoConstants().AMPERSAND + this.getCognitoConstants().DOMAIN_QUERY_PARAM_USERCONTEXTDATA + this.getCognitoConstants().EQUALSIGN + this.getUserContextData();\n    } // Build the complete web domain to launch the login screen\n\n\n    var uri = this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH, this.getAppWebDomain(), this.getCognitoConstants().SLASH, this.getCognitoConstants().DOMAIN_PATH_SIGNIN, this.getCognitoConstants().QUESTIONMARK, this.getCognitoConstants().DOMAIN_QUERY_PARAM_REDIRECT_URI, this.getCognitoConstants().EQUALSIGN, encodeURIComponent(this.RedirectUriSignIn), this.getCognitoConstants().AMPERSAND, this.getCognitoConstants().DOMAIN_QUERY_PARAM_RESPONSE_TYPE, this.getCognitoConstants().EQUALSIGN, this.responseType, this.getCognitoConstants().AMPERSAND, this.getCognitoConstants().CLIENT_ID, this.getCognitoConstants().EQUALSIGN, this.getClientId(), this.getCognitoConstants().AMPERSAND, this.getCognitoConstants().STATE, this.getCognitoConstants().EQUALSIGN, this.state, this.getCognitoConstants().AMPERSAND, this.getCognitoConstants().SCOPE, this.getCognitoConstants().EQUALSIGN, tokenScopesString, identityProviderParam, userContextDataParam);\n    return uri;\n  };\n  /**\n   * Sign out the user.\n   * @returns {void}\n   */\n\n\n  CognitoAuth.prototype.signOut = function signOut() {\n    var URL = this.getFQDNSignOut();\n    this.signInUserSession = null;\n    this.clearCachedTokensScopes();\n    this.launchUri(URL);\n  };\n  /**\n   * Create the FQDN(fully qualified domain name) for signout endpoint.\n   * @returns {string} url\n   */\n\n\n  CognitoAuth.prototype.getFQDNSignOut = function getFQDNSignOut() {\n    var uri = this.getCognitoConstants().DOMAIN_SCHEME.concat(this.getCognitoConstants().COLONDOUBLESLASH, this.getAppWebDomain(), this.getCognitoConstants().SLASH, this.getCognitoConstants().DOMAIN_PATH_SIGNOUT, this.getCognitoConstants().QUESTIONMARK, this.getCognitoConstants().DOMAIN_QUERY_PARAM_SIGNOUT_URI, this.getCognitoConstants().EQUALSIGN, encodeURIComponent(this.RedirectUriSignOut), this.getCognitoConstants().AMPERSAND, this.getCognitoConstants().CLIENT_ID, this.getCognitoConstants().EQUALSIGN, this.getClientId());\n    return uri;\n  };\n  /**\n   * This method returns the encoded data string used for cognito advanced security feature.\n   * This would be generated only when developer has included the JS used for collecting the\n   * data on their client. Please refer to documentation to know more about using AdvancedSecurity\n   * features\n   **/\n\n\n  CognitoAuth.prototype.getUserContextData = function getUserContextData() {\n    if (typeof AmazonCognitoAdvancedSecurityData === \"undefined\") {\n      return;\n    }\n\n    var _username = \"\";\n\n    if (this.username) {\n      _username = this.username;\n    }\n\n    var _userpoolId = \"\";\n\n    if (this.userpoolId) {\n      _userpoolId = this.userpoolId;\n    }\n\n    if (this.advancedSecurityDataCollectionFlag) {\n      return AmazonCognitoAdvancedSecurityData.getData(_username, _userpoolId, this.clientId);\n    }\n  };\n  /**\n   * Helper method to let the user know if he has either a valid cached session \n   * or a valid authenticated session from the app integration callback.\n   * @returns {boolean} userSignedIn \n   */\n\n\n  CognitoAuth.prototype.isUserSignedIn = function isUserSignedIn() {\n    return this.signInUserSession != null && this.signInUserSession.isValid() || this.getCachedSession() != null && this.getCachedSession().isValid();\n  };\n\n  return CognitoAuth;\n}();\n\nexport default CognitoAuth;","map":null,"metadata":{},"sourceType":"module"}