{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Logger_1 = require(\"./Logger\");\n\nvar logger = new Logger_1.ConsoleLogger('Hub');\n\nvar HubClass =\n/** @class */\nfunction () {\n  function HubClass(name) {\n    this.bus = [];\n    this.listeners = {};\n    this.name = name;\n  }\n\n  HubClass.createHub = function (name) {\n    return new HubClass(name);\n  };\n\n  HubClass.prototype.dispatch = function (channel, payload, source) {\n    if (source === void 0) {\n      source = '';\n    }\n\n    var capsule = {\n      'channel': channel,\n      'payload': Object.assign({}, payload),\n      'source': source\n    };\n\n    try {\n      this.bus.push(capsule);\n      this.toListeners(capsule);\n    } catch (e) {\n      logger.warn('Hub dispatch error', e);\n    }\n  };\n\n  HubClass.prototype.listen = function (channel, listener, listenerName) {\n    if (listenerName === void 0) {\n      listenerName = 'noname';\n    }\n\n    logger.debug(listenerName + ' listening ' + channel);\n    var holder = this.listeners[channel];\n\n    if (!holder) {\n      holder = [];\n      this.listeners[channel] = holder;\n    }\n\n    holder.push({\n      'name': listenerName,\n      'listener': listener\n    });\n  };\n\n  HubClass.prototype.remove = function (channel, listener, listenerName) {\n    if (listenerName === void 0) {\n      listenerName = 'noname';\n    }\n\n    logger.debug(listenerName + ' removing listener ' + channel);\n    var holder = this.listeners[channel];\n\n    if (holder) {\n      holder = holder.filter(function (_listener) {\n        return !(listener === _listener.listener && listenerName === _listener.name);\n      });\n      this.listeners[channel] = holder;\n    }\n  };\n\n  HubClass.prototype.toListeners = function (capsule) {\n    var channel = capsule.channel,\n        payload = capsule.payload,\n        source = capsule.source;\n    var holder = this.listeners[channel];\n\n    if (!holder) {\n      return;\n    }\n\n    holder.forEach(function (listener) {\n      try {\n        listener.listener.onHubCapsule(capsule);\n      } catch (e) {\n        logger.warn(\"error happend when dispatching \" + channel + \" event to \" + listener.name + \": \" + e);\n      }\n    });\n    this.bus.pop();\n  };\n\n  return HubClass;\n}();\n\nexports.HubClass = HubClass;\nvar Hub = new HubClass('__default__');\nexports.default = Hub;","map":null,"metadata":{},"sourceType":"script"}